(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9727],{1614:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[token]",function(){return t(3317)}])},927:function(e,n,t){"use strict";var i,l;t.d(n,{x:function(){return i}}),(l=i||(i={})).VISIT="VISIT",l.SPEND="SPEND",l.ITEM_VARIATION="ITEM_VARIATION",l.CATEGORY="CATEGORY"},6680:function(e,n,t){"use strict";t.d(n,{p:function(){return formatFromCents}});let i={},l={};function formatFromCents(e,n){let{locale:t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e/function(e){let n=l[e];return void 0===n?100:n}(n),o=r%1>0,a=function(e){let n=i[e.toUpperCase()];return void 0===n?2:n}(n);return new Intl.NumberFormat(t,{style:"currency",currency:n,minimumFractionDigits:o?a:0,maximumFractionDigits:o?a:0}).format(r)}},3317:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSP:function(){return T},default:function(){return EnrollPage}});var i=t(5893),l=t(7769),r=t(2934),o=t(7294),a=t(6068),u=t(1163),s=t(2814),c=t(3394),d=t(3044),f=t(9008),p=t.n(f),m=t(9234),y=t(7865),h=t(1798);function Disclaimer(){let{t:e}=(0,h.$G)();return(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",color:"gray"},children:(0,i.jsx)("p",{className:"paragraph-10",children:e("enroll-unified.disclaimer")})})}var g=t(1487),x=t(9875),v=t(3591),b=t(4068),j=t(5038),E=t(7050);function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function isValidUsPhoneNumber(e){return/^\d{10,11}$/.test(e)}var k=t(6680),S=t(927);let P={[S.x.VISIT]:{i18nKey:"enroll-unified.description.loyalty.by-visit",getParams(e,n,t){let{points:i,visitMinimumAmountMoney:l}=n;return{count:i,points:1===i?t.one:t.other,amount:(0,k.p)(l.amount,l.currency,{locale:e})}}},[S.x.SPEND]:{i18nKey:"enroll-unified.description.loyalty.by-amount-spent",getParams(e,n,t){let{points:i,spendAmountMoney:l}=n;return{count:i,points:1===i?t.one:t.other,amount:(0,k.p)(l.amount,l.currency,{locale:e})}}},[S.x.ITEM_VARIATION]:{i18nKey:"enroll-unified.description.loyalty.by-item",getParams(e,n,t){let{points:i}=n;return{count:i,points:1===i?t.one:t.other}}},[S.x.CATEGORY]:{i18nKey:"enroll-unified.description.loyalty.by-category",getParams(e,n,t){let{points:i}=n;return{count:i,points:1===i?t.one:t.other}}}};function UnifiedForm(e){var n;let t,{token:r}=e,s=(0,u.useRouter)(),{t:f}=(0,h.$G)(),[k,S]=(0,o.useState)(""),[w,T]=(0,o.useState)(""),[_,C]=(0,o.useState)(!0),[N,V]=(0,o.useState)(!0),[I]=(0,a.o)(l.gA),[U,O]=(0,o.useState)(!1),[,F]=(0,a.o)(l.n6),[,A]=(0,a.o)(l.lQ),[R,D]=(0,o.useState)(j.g.V3),[Z,M]=(0,o.useState)(!0),[K,B]=(0,o.useState)(null),[G,Q]=(0,o.useState)(!1),[Y,L]=(0,o.useState)(!1);if((0,o.useEffect)(()=>{x.Z.trackPageView({page_view_description:"Marketing: Off POS: Unified Flow: Entry"})},[]),!I)return!1;function onError(e){F({text:null!=e?e:f("error.generic"),variant:"warning"})}async function submit(e){e.preventDefault(),O(!0),x.Z.trackPageClick((0,v.y2)("button-click","Marketing: Off POS: Unified Flow: Sign Up"));try{let{isEnrolled:e}=await (0,d.MA)(w&&_?w:null,k&&N?k:null,r,K,R,f);if(e){s.push("".concat((0,l.Ql)(r),"/already-in"));return}if(!I.programs||!I.consentCopy)return;let n=I.programs.map(e=>{let n=I.consentCopy[e];if(n){let e=n[null==I?void 0:I.defaultLocale];if(e&&e.length>0)return e[0].copyToken}return null}).filter(Boolean),{programsEnrolled:t}=await (0,d.TG)(w&&_?w:null,k&&N?k:null,r,n,K,R,f);t&&0!==t.length?(A(t),s.push("".concat((0,l.Ql)(r),"/joined"))):s.push("".concat((0,l.Ql)(r),"/already-in"))}catch(e){e instanceof E.Z&&R===j.g.V3?D(j.g.V2):onError(null==e?void 0:e.message)}finally{O(!1)}}let $=null;if(I.loyalty){let e=I.loyalty.accrualRules[0],{accrualType:n}=e,{terminology:t}=I.loyalty,{i18nKey:i,getParams:l}=P[n]||{};i?$=f(i,null==l?void 0:l(null==I?void 0:I.defaultLocale,e,t)):reportError(new c.Z("Unexpected loyalty accrualType: ".concat(n)))}let{logoUrl:X,merchantName:J,coupon:q,programs:z,loyalty:H,merchantToken:W}=I,ee=(n=z.includes("loyalty"),t="enroll-unified.heading-has-loyalty-with-coupon",n||q?!n&&q?t="enroll-unified.heading-no-loyalty-with-coupon":n&&!q&&(t="enroll-unified.heading-has-loyalty-no-coupon"):t="enroll-unified.heading-no-loyalty-no-coupon",f(t,{coupon:q}));return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p(),{children:(0,i.jsx)("title",{children:ee})}),(0,i.jsx)(m.Z,{children:(0,i.jsxs)("div",{children:[X&&(0,i.jsx)(y.Z,{src:X}),(0,i.jsx)("h2",{children:ee}),H?(0,i.jsxs)("p",{children:[$,(0,i.jsx)("br",{}),(0,i.jsx)("a",{className:"unified-form-learn-more-link",href:"/loyalty/".concat(W),children:f("enroll-unified.learn-more")})]}):(0,i.jsx)("p",{children:f("enroll-unified.description.no-loyalty",{merchant:J})}),(0,i.jsxs)("form",{onSubmit:submit,children:[(0,i.jsxs)(g.Fx,{...!_&&{invalid:!0},children:[(0,i.jsx)(g.mY,{"data-testid":"email-input",type:"email",value:w,onKeyUp:function(e){T(e.currentTarget.value),isValidEmail(e.currentTarget.value)&&(G||Q(!0),C(!0))},onBlur:function(){C(isValidEmail(w))},onClick:function(){x.Z.trackPageClick((0,v.y2)("button-click","Marketing: Off POS: Unified Flow: Entered Email Address"))},children:(0,i.jsx)("label",{children:f("enroll-unified.input.email-placeholder")})},"email-input"),(0,i.jsx)("small",{slot:"error",children:!_&&f("error.invalid-email")})]}),(0,i.jsx)("br",{}),(0,i.jsxs)(g.Fx,{...!N&&{invalid:!0},children:[(0,i.jsx)(g.mY,{"data-testid":"phone-input",type:"tel",value:k,onKeyUp:function(e){let n=e.currentTarget.value.replace(/\D/g,"");S(n),isValidUsPhoneNumber(n)&&(Y||L(!0),V(!0))},onBlur:function(){V(isValidUsPhoneNumber(k))},onClick:function(){x.Z.trackPageClick((0,v.y2)("button-click","Marketing: Off POS: Unified Flow: Entered Phone Number"))},children:(0,i.jsx)("label",{children:f("enroll-unified.input.phone-placeholder")})},"phone-input"),(0,i.jsx)("small",{slot:"error",children:!N&&f("error.invalid-phone")})]}),R===j.g.V2&&(0,i.jsx)(b.ReCaptchaV2,{callback:function(e){"string"==typeof e?(B(e),M(!0)):"boolean"!=typeof e||e?e instanceof Error&&(M(!1),onError(e.message)):M(!1)},style:{width:"304px",margin:"10px 0 0"}}),(0,i.jsx)(b.ReCaptchaV3,{action:"submit",callback:function(e){"string"==typeof e&&B(e)}}),(0,i.jsx)(g.cJ,{...!((!k||N)&&(!w||_)&&Z&&(k&&N||w&&_)&&!U)&&{disabled:!0},rank:"primary",type:"submit",children:f("all.button.sign-up")})]}),(0,i.jsx)("br",{}),(0,i.jsx)(Disclaimer,{})]})})]})}let w=new Set(["en-US","es-US"]);var T=!0;function EnrollPage(){let e=(0,u.useRouter)(),[,n]=(0,a.o)(l.XP),[,t]=(0,a.o)(l.U8),[,d]=(0,a.o)(l.bJ),[,f]=(0,a.o)(l.rj),[p]=(0,a.o)(l.gA),[m]=(0,a.o)(l.mB),[y,h]=(0,o.useState)(!1),g=(0,o.useContext)(s.d);return(0,o.useEffect)(()=>{if(e&&g&&!w.has(p.defaultLocale)){var i,o;let a=[(null==p?void 0:null===(i=p.programs)||void 0===i?void 0:i[0])==="marketing"&&"marketing",(null==p?void 0:null===(o=p.programs)||void 0===o?void 0:o[0])==="loyalty"&&"loyalty"].find(Boolean);n(null),t(null),d(!1),f(!1),a&&!y?(h(!0),e.push("".concat((0,l.Ql)(m),"/").concat(a))):y||(0,r.e)(new c.Z("Unable to determine initial program route for BuyerFacingOptInConfig ".concat(m)))}},[y,p,g,e,n,d,f,t,m]),!!w.has(p.defaultLocale)&&(0,i.jsx)(UnifiedForm,{token:m})}},9008:function(e,n,t){e.exports=t(4605)}},function(e){e.O(0,[8898,976,9774,2888,179],function(){return e(e.s=1614)}),_N_E=e.O()}]);